<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Yqf's Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Yqf's Blog">
<meta property="og:url" content="http://yqf3139.github.io/index.html">
<meta property="og:site_name" content="Yqf's Blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Yqf's Blog">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> Yqf's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  






  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Yqf's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Day day up.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            Tags
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">

    

    
    
      
      
        
        
        
      

      
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/23/GUI-Turing-editor-and-runner-demo-how-native-Turing-Machine-calculate-the-N-th-fibonacci-number/" itemprop="url">
                  朴素的图灵机编辑器和模拟器
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Posted on
            <time itemprop="dateCreated" datetime="2017-01-23T19:14:00+08:00" content="2017-01-23">
              2017-01-23
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; In
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/programming/" itemprop="url" rel="index">
                    <span itemprop="name">programming</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/01/23/GUI-Turing-editor-and-runner-demo-how-native-Turing-Machine-calculate-the-N-th-fibonacci-number/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/23/GUI-Turing-editor-and-runner-demo-how-native-Turing-Machine-calculate-the-N-th-fibonacci-number/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="简介">简介</h1><h2 id="问题">问题</h2><p>题目：输出斐波拉契数列的图灵机。</p>
<p>要求：设计图灵机，输入n，然后输出斐波拉契数列的第n项。<br>(需要有图形界面和测试例子)</p>
<h2 id="功能">功能</h2><ul>
<li>图形化的通用图灵机编辑器。</li>
<li>半无限带图灵机模拟器，以及可视化调试环境。</li>
<li>使用上述环境实现题目要求的图灵机，并进行了局部性能优化。</li>
</ul>
<h2 id="开发说明">开发说明</h2><p>本次作业使用Web技术开发，其中vis图形库用于图灵机的设计与调试可视化，npm包管理，grunt用于工作流控制。<br>项目目录如下：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ tree . -L <span class="number">1</span></span><br><span class="line">.</span><br><span class="line">├── build                   <span class="comment">// Javascript文件中间结果存放</span></span><br><span class="line">│   └── bundle<span class="class">.js</span></span><br><span class="line">├── Gruntfile<span class="class">.js</span>            <span class="comment">// 定义Grunt自动化任务，如Browserify，Uglyfy</span></span><br><span class="line">├── node_modules            <span class="comment">// 使用npm install安装得到的依赖包</span></span><br><span class="line">├── package<span class="class">.json</span>            <span class="comment">// 描述项目依赖等信息</span></span><br><span class="line">├── public                  <span class="comment">// Web根目录</span></span><br><span class="line">│   ├── bundle<span class="class">.min</span><span class="class">.js</span>       <span class="comment">// 打包、代码混淆后的源文件</span></span><br><span class="line">│   ├── bundle<span class="class">.min</span><span class="class">.js</span><span class="class">.map</span>   <span class="comment">// 调试信息</span></span><br><span class="line">│   ├── <span class="tag">img</span></span><br><span class="line">│   ├── index<span class="class">.html</span>          <span class="comment">// Html布局文件</span></span><br><span class="line">│   └── vis<span class="class">.min</span><span class="class">.css</span>         <span class="comment">// vis图形库所需的层叠式样式表文件</span></span><br><span class="line">├── readme<span class="class">.md</span></span><br><span class="line">├── src                     <span class="comment">// 程序逻辑源文件夹</span></span><br><span class="line">│   ├── app<span class="class">.js</span>              <span class="comment">// 主程序</span></span><br><span class="line">│   ├── turing<span class="class">.js</span>           <span class="comment">// 图灵机编译与模拟器</span></span><br><span class="line">│   └── util<span class="class">.js</span>             <span class="comment">// 工具函数</span></span><br><span class="line">└── tmws                    <span class="comment">// 序列化的图灵机文件</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>依赖包安装：<code>npm install</code></li>
<li>编译、打包源文件：<code>grunt</code></li>
<li>启动服务器：<code>cd public &amp;&amp; python3 -m http.server</code></li>
</ul>
<h1 id="使用说明">使用说明</h1><ul>
<li>最简单的图灵机（读0写1,读1个1便接受）的设计、运行与调试，见视频Demo-1。</li>
<li>斐波拉契数列图灵机的读取、运行，见视频Demo-2，输入输出格式见图灵机设计描述。</li>
<li>在线Demo，<a href="http://security-administrator-alfred-48418.bitballoon.com/" target="_blank" rel="external">地址</a>。</li>
<li>代码，<a href="https://github.com/yqf3139/turing-gui" target="_blank" rel="external">Github Repo</a></li>
</ul>
<p><img src="http://ok8l5e08o.bkt.clouddn.com/demo1.gif" alt="Demo1"></p>
<p>Demo1</p>
<p><img src="http://ok8l5e08o.bkt.clouddn.com/demo2.gif" alt="Demo2"></p>
<p>Demo2</p>
<p>斐波拉契数列图灵机的文件见twms文件夹。</p>
<p>从视频Demo中可以轻松地看出图灵机的图形化设计、保存装载、编译重置、运行调试过程，<br>如下两张图展示了图灵机编译与运行过程中出现的错误提示。<br><img src="/images/turing-gui/1.jpg" alt="运行时错误提示"><br><img src="/images/turing-gui/2.jpg" alt="编译时错误提示"></p>
<h1 id="图灵机设计">图灵机设计</h1><h2 id="输入输出格式">输入输出格式</h2><p>工作区示意：<code>&lt;迭代次数计数器 C &gt;1&lt;当前计算的Fib数 M &gt;1&lt;上一次迭代计算的Fib数 N &gt;</code></p>
<p>输入格式： <code>0{n}101</code></p>
<p>输入样例：</p>
<ul>
<li>n=1: <code>0101</code></li>
<li>n=3: <code>000101</code></li>
<li>n=5: <code>00000101</code></li>
</ul>
<p>在上述样例中，从首位开始的连续的<code>0</code>的个数描述了n，后面紧跟的<code>1</code>是分割符号，<br>再后面一个<code>0</code>表示1，这是由于斐波那契数列的第一位数为1，再后面跟着一个<code>1</code>作为分割符。</p>
<p>输出格式： 读头指向连续0的个数为所求的第n位斐波那契数列的值，<code>0{fib(n)}10{fib(n-1)}</code>。</p>
<p>输出样例：</p>
<ul>
<li>n=1: <code>$1[读头&gt;]01</code></li>
<li>n=3: <code>$$$1[读头&gt;]0010</code></li>
<li>n=5: <code>$$$$$1[读头&gt;]000001000</code></li>
</ul>
<h2 id="计算思路">计算思路</h2><ul>
<li>单次迭代过程：将M复制一份到N后的空白区域，然后将M和N的分隔符移动到新复制的M的前一格。目的是计算将M+N赋予M，M赋予N。</li>
<li>迭代控制：若C不为0,则将C的计数器减1，然后执行上述迭代操作，并回到起始位置；否则移动读头到M的位置。</li>
<li>复制控制：逐个Bit将M复制到N后的空白区域。</li>
</ul>
<h2 id="转换图表示">转换图表示</h2><p><img src="/images/turing-gui/fib1.jpg" alt="第一个图灵机示意图"></p>
<h2 id="局部优化与效果">局部优化与效果</h2><p>观察上述图灵机，一个性能优化点在于在复制M的时候，新复制的M可以不全部写为$，再后期写为0，而可以改为将第一位标记为$，而后面的位都直接复制为0。这样后期就可以省去再将新N全部改写为0的操作了，而第一位标记为$是为了方便在新M和N之间放置分界符1。改动如下图所示：</p>
<p><img src="/images/turing-gui/fib2.jpg" alt="第二个图灵机示意图"></p>
<p>针对如上的性能优化点，收集两个图灵机的步数随N的变化数据，结果如下：<br><img src="/images/turing-gui/data.png" alt="优化效果"></p>
<p>可以看出，虽然第二个图灵机总是比第一个图灵机步数少，但性能的提升占总步数的比例却非常低，步数随着N呈指数级别上升，而优化的步数只呈现线性增长。</p>
<h1 id="工程实现">工程实现</h1><h2 id="使用Vis实现图绘制与操作">使用Vis实现图绘制与操作</h2><p><a href="http://visjs.org/index.html" target="_blank" rel="external">Vis.js</a>是一个基于浏览器的动态Javascript可视化库，其中封装好了高度可定制化、可视化的网络模块。为了实现图灵机的动态编辑，我基于Visjs开源的<a href="http://visjs.org/examples/network/other/manipulation.html" target="_blank" rel="external">示例程序</a>，加入了图灵机设计中需要的元素，以方便用户通过可视化的界面创建图灵机。</p>
<p>图灵机的绘制与操作逻辑主要位于<code>src/app.js</code>中，主要描述以下功能：</p>
<h3 id="创建图灵机设计绘图区">创建图灵机设计绘图区</h3><p>程序界面由<code>index.html</code>描述，主要分为两部分。网络编辑与可视化区域由id为<code>mynetwork</code>的网络绘图区，和id为<code>network-popUp</code>的网络信息编辑窗口构成。</p>
<p>控制面板由编译与调试信息，网络保存与载入控件，条带编辑区域和图灵机运行控制控件组成。在<code>document.body.onload</code>方法中可以看到对应控件的事件回调函数。</p>
<h3 id="定义图中点和边的对应操作">定义图中点和边的对应操作</h3><p><code>createNetwork</code>函数生成网络中初始的两个实例节点，并在<code>mynetwork</code>创建网络实例。其中的<code>options</code>参数描述了适用于图灵机的网络配置信息。<br><code>options.layout</code>定义了网络的点和边的布局，物理效果（点排斥，边吸引）可以更好地设计图灵机中的状态和转换。<br><code>options.manipulation</code>定义了网络中的六个基本事件的响应，点、边的增删改。对于点和边的增改，我们都给用户弹出信息编辑界面，并将数据保存在响应的点或是边中。对于新创建的点和边，赋予初始值。对于特殊的点和边，比如开始状态和结束状态，相应地修改点的特性以方便用户查看。</p>
<h3 id="保存与载入">保存与载入</h3><p>使用<code>saveWorkspace</code>函数将网络信息以JSON格式保存在文件中。<br>使用<code>restoreWorkspace</code>函数将用户选择的文件中的JSON信息重新解析为网络信息，并使用该网络信息创建网络，刷新界面。</p>
<h2 id="图灵机的编译">图灵机的编译</h2><p>图灵机的相关逻辑编写在<code>src/turing.js</code>模块中，对外暴露图灵机的主要数据结构以及图灵机的控制函数，同时需要提供信息输出接口，对网络中元素的高亮操作接口以及网络绘制回调。</p>
<p>图灵机数据结构中保存有如下信息：图灵机转换表，起始状态，读头位置，当前步数，当前状态，输入条带以及其他控制信息。</p>
<p>图灵机的编译函数为<code>turing.makeTable</code>。通过图的遍历，将图形化的图灵机翻译为图灵机状态转换表。状态转换表是一个二维映射表。第一层映射为状态到该状态的所有转换的映射；第二层映射为输入字符到某状态的其中一个转换的映射。</p>
<p>通过<code>reset</code>，完成图灵机运行前信息的初始化。</p>
<h2 id="图灵机的运行与调试">图灵机的运行与调试</h2><p>图灵机的运行函数为<code>start</code>，单步调试函数为<code>step</code>，其中运行函数不断调用单步函数，每一步的时间间隔可调。</p>
<p>单步函数每次以当前状态，当前读头下的字符作为输入，在图灵机转换边中，通过两层映射找到对应的转换，并按照转换中的下一个状态、下一个字符和读头移动方向更新图灵机状态信息，在信息更新后，调用高亮函数在图灵机的可视化界面上提示当前图灵机的运行状态，并调用绘图回调刷新用户界面；如果未找到，则停机并输出调试信息；如果图灵机下一步没有转换并且当前状态可以接受，那么图灵机成功停机并输出信息。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/19/trans-the-beckman-report-on-database-research/" itemprop="url">
                  The Beckman Report on Database Research (翻译)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Posted on
            <time itemprop="dateCreated" datetime="2016-09-19T11:15:04+08:00" content="2016-09-19">
              2016-09-19
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; In
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/trans/" itemprop="url" rel="index">
                    <span itemprop="name">trans</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/19/trans-the-beckman-report-on-database-research/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/19/trans-the-beckman-report-on-database-research/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>数据库研究者将大数据描绘为一个决定性的挑战。我们需要集中精力在五个研究热点上才能最大程度地利用现在众多的机会。</p>
<p>数据库的一小队核心研究人员通过周期性的例会，交流探讨领域内的发展状态，并指出未来的核心发展方向。例会已经成功举办了多届，比如1989,1990,1995,1996,1998,2003,2008。28名数据库研究员和2位受邀的嘉宾于2013年10月在加州大小Irvine分校的Beckman中心举行了为期两天的讨论，延续了这一传统。<br>虽然参会人员被限定在了30人，这是为了最大程度地保证参会人员相互之间进行良好的互动，但他们分别代表了来自不同方向、资历和地区的研究兴趣。本文总结了本次会议的一些结论，更加详细的报告和与会人员的展示可以在<a href="http://beckman.cs.wisc.edu" target="_blank" rel="external">这里</a>找到。</p>
<h1 id="本文关键点">本文关键点</h1><ul>
<li>在2013年十月，来自数据库研究领域的三十位代表讨论了领域内的研究状态，并展望了未来的研究方向。</li>
<li>大数据被认为是领域内的一个决定性挑战。他们提出了五个相关的挑战：开发可伸缩的数据基础建构；应对在数据和数据管理中日益增加的多样性；提出端到端、数据到知识的处理管线；拥抱云计算的广泛普及和协调众多不断变化的人的角色。</li>
</ul>
<p>与会人员很快就大数据带来的决定性的挑战达成了一致。大数据问题的崛起是由于以下三个主要趋势。</p>
<ol>
<li>廉价的存储、传感器、智能设备、社交软件、多玩家游戏和让家、汽车、电器和其他设备互联的物联网让数据的产生的渠道越来越广；</li>
<li>多核处理器、固态硬盘、廉价的云计算资源和开源软件都让产生巨量的数据越来越容易；</li>
<li>数据管理正变得自治化。数据的产生、处理和消耗并不仅仅是数据库专家的专利了，数据管理已经成为了决策者、领域专家、用户、记者和工人的日常。</li>
</ol>
<p>随着这些数据浪潮的到来，从未出现过的巨大容量的数据需要被捕捉、存储、查询、处理并转变为知识。这些目标同十几年来被数据驱动的研究团体的目标非常吻合。很多早期的大数据系统抛弃了数据库管理系统的一些核心思想，例如声明式编程和事务数据一致性，从而换取伸缩性和在商用硬件上实现容错性。不过，在最新的大数据系统中，人们重新发现了这些核心的约束思想，并接受了一些在数据库领域长久以来的思想精髓。在这些核心约束和精髓上构建起来的数据库社区，有能力为大数据技术带来改革性质的改善。</p>
<p>不过大数据也带来了极大的挑战，提出的解决方案需要对数据管理解决方案的设计、实现和部署进行破坏性的革新。大数据的主要特点是容量、速度和多样性。数据库研究团体致力于推动容量和速度的研究多年，设计出的研究方案基础触及到所有的企业。而大数据浪潮带来的海量数据，让研究人员需要对已有的解决方案进行更加深入的探讨。</p>
<p>多样性来源于不同的数据源。</p>
<ul>
<li>首先，不同格式和质量的数据集成和分析成为了一个难题。这是数据库领域内一个长久存在的话题，不过从原始数据到可以使用的知识从目前来说还是需要耗费大量的人力。大数据加重了这个问题，这导致了数据处理管线中出现了一个主要的瓶颈；</li>
<li>第二，需要处理大数据的平台也有很多的变数：硬件基础设施、处理软件框架、编程语言、系统和编程抽象；</li>
<li>最后，用户也带来了复杂的需求和不同的偏好。想设计一个数据管理解决方案应对这么多的多样性是一个极大的挑战。</li>
</ul>
<p>除了三个V（容量、速度和多样性），<strong>众多的大数据应用选择在云计算平台上部署,这不论是公有还是私有云</strong>。这需要提供性能可预测、互操作灵活的新技术。很多的应用需要人来解决很多难以自动解决的语义理解问题。这包含了某个领域的专家或是很多工人，或是整个互联网（比如维基百科）。这就需要帮助人们便得更加高效的新技术，与此同时尽量降低解决这些问题需要的人力能力等级。</p>
<p>总而言之，大数据为研究人员带来了极大的挑战。我们必须重新思考教授数据管理的方法，重新审视我们的研究历程，适应这数据科学这个新研究分支的出现。</p>
<h1 id="研究的挑战">研究的挑战</h1><p>本次会议指出了五个大数据带来的挑战：</p>
<ul>
<li>可伸缩的数据基础设施，提供大容量高速的服务</li>
<li>应对大数据管理中的多样性</li>
<li>端到端数据处理</li>
<li>云服务</li>
<li>在数据生命周期中人的职责</li>
</ul>
<p>其中前三个挑战分别对应着大数据的容量、速度和多样性。后两个对应着云计算环境下大数据应用的部署和管理人在其中职责的变更。</p>
<p>在已有工作下，这些挑战并不是额外孤立的方向。近年来，数据库研究团体已经加强了关系数据管理系统的核心功能，并衍生出很多新的方向。会议中，诸多问题被提出：安全、隐私、数据属性、社交、移动、时空变化、私人、带有情景的、能耗敏感和科学数据管理的问题，其中很多与现有的大数据挑战有交叉，可以在相关领域深入讨论。</p>
<p>很多工作是与其他计算机科学领域合作完成的，比如分布式系统、人工智能、知识发现、数据挖掘、人机互动和电子科研。在许多案例中，这些专有的领域带来了新技术的灵感，并结合数据库研究人员的专业知识一起提出健壮的解决方案。这些高效地跨方向合作应该被大力提倡。</p>
<h1 id="可伸缩的大规模/快速数据基础设施">可伸缩的大规模/快速数据基础设施</h1><h2 id="并行和分布式数据处理">并行和分布式数据处理</h2><p>在数据库领域，大规模结构化数据的并行处理已经成功实现，这让众多基于SQL的产品在企业中大规模使用成为了可能。另一个成功应用在于数据仓库，数据库研究人员定义了数据立方（为了联机分析处理，OLAP）的关键概念和并行查询的策略，也更好地支持了实物化视图和数据复制。在大规模普通商用机器上，分布式领域已经用一些编程模型，例如MapReduce，在处理更大的非结构化数据方面取得了成功。在此基础上，更加高层的语言让更广阔的开发者群体可以使用大数据平台的扩展性。如今，像是Hadoop之类的开源平台已经在处理非结构化数据方向上获得了广泛的采纳，原因在于它MapReduce的编程模型、大规模的分布式存储系统和更高层的应用语言（Pig和Hive），这让传统的公司也开始使用这一技术。</p>
<h2 id="查询处理和优化">查询处理和优化</h2><p>声明式语言在大数据处理方向上广泛的普及，越来越多的人关注到代价敏感的查询优化器和面向集合的查询引擎的重要性。这将充分利用大规模多核机器集群的潜能，做到“纵向”与“横向”扩展。这就为处理过程监控带来了挑战，比如一个用户可以分析管理哪一个查询耗时过长或是占用了太多的计算资源。为了适应未曾分析过的数据格式，并减少数据分析阶段数据传输的代价，查询处理器需要将数据样本抽取、数据挖掘和机器学习整合在处理流程中。</p>
<h2 id="新兴的硬件">新兴的硬件</h2><p>对于一个数据中心的规模，随着更快的网络、服务器间完全二等分带宽的网络和远程内存直接访问技术的发展，顺序处理和网路传输的速度比率不断变化。除了通用多核处理器组成的集群，更多专用处理器也可纳入考虑范围。成功的商用数据库机器已经展示了软硬件协同设计的数据库管理系统的潜能。研究人员得考虑利用专用处理器，比如GPU、FPGA和应用专用集成电路来处理超大规模的数据集合。这些通信和处理技术革新将带来并行和分布式查询处理算法的重新考量，因为之前的算法是基于相同的硬件环境设计的。</p>
<h2 id="经济的存储">经济的存储</h2><p>数据库研究团体必须学会怎样利用最新的内存和存储技术。和传统的磁盘相比，固态硬盘虽然每GB价格较贵，但I/O操作延时小。多种非易失随机访问内存技术正在实验阶段，它们拥有不同的速度、能耗和耐久特性。</p>
<p>要考虑服务器扩展存储和网络扩展存储。例如HDFS的分布式的文件系统，虽然是服务器存储但却是网络共享的，这是两种方式的结合。怎样最好地利用一系列的存储？这像是重新回到了以前的共享内存或是共享磁盘或是不共享的旧的争论中，之前已经画上句号的争论随着硬件的升级可能需要重新被提起。</p>
<h2 id="高速数据流">高速数据流</h2><p>对于高速生成的数据流，我们需要新的可伸缩技术来应对数据流的处理和消化。比如说，应对不统一的内存访问和多层内存层级下的访问速度限制，这些数据流的信息密度低，所以需要在线实时处理后就丢弃掉不用的数据。更进一步，这些数据的样本和聚合统计信息需要被挑选出，并存储下来以应对稍后的查询和分析。对于这样的数据，渐进的查询处理提供了增量和部分查询结果，而在数据不断涌动处理的同时，逐渐地精确度提高，这种渐进式的处理十分重要。</p>
<h2 id="后绑定模式">后绑定模式</h2><p>对于被保持下来的数据，在其生命周期中可能只会发生一次被处理的机会（有可能从未被处理到），预先在数据库中对其进行处理和索引就非常不经济了。这样的数据应该被以二进制的方式保存下来，在被处理的时候再把它结构化解析。结果有可能是以自描述的方式存储的，键值对形式例如JSON，以预定义的模式进行解析或是使用数据挖掘进行演绎。为了提供在此情况下数据处理的最优方式，我们需要数据库可以以后绑定模式在原始文件上进行处理的查询引擎。</p>
<h2 id="一致性">一致性</h2><p>在今天，数据捕获、更新和简单快速地数据访问成为了新需求。对于非结构化数据来说，处理高速的数据捕获和更新需求导致了NoSQL系统的发展。目前有很多这类系统，提出了一系列的事务处理模型。大多是仅仅提供了基本的数据访问和弱原子操作保证。这让基于这些系统构建可信系统成为了难题。不过，大数据中一个新兴的团体通过键值存储提供了类数据库的成熟特性。对于一些用用来说，存储的数据对于一个公司来说就是“事实和真理”。对于其他应用来说，例如物联网，存储的数据反映着外界世界的情况，通过这些信息，应用可以做出相应的反映出。这就为重新考虑保证数据流通和一致性的编程模型和机制带来了机会，基于这些模型和技术，可以保证更加健壮的应用。</p>
<h2 id="指标和基准">指标和基准</h2><p>可扩展性不应该仅仅用数据的容量和每秒查询次数来度量。还应该以数据处理方的总体消耗（包括管理和能耗），端到端的处理速度（从原始数据获取到最终知识的输出），系统的稳定性（可以容忍部分数据的解析错误）和可用度（尤其对于入门用户来说）。为了度量这么多的指标，需要提出新的基准测试。</p>
<h1 id="数据管理中的多样性">数据管理中的多样性</h1><h2 id="不存在通解">不存在通解</h2><p>在今天，和传统的企业数据相比数据的种类、形式和规模都多种多样，形成了这个数据驱动的世界，传统的数据储存在为分析专门优化过的数据仓库中。现在数据通常以不同的表示形势，以不同的应用程序接口、查询工具提供出来。这样看来，不太可能一个大型的数据系统可以符合所有这些灵活性的要求。我们期望看到不同类别的系统涌现，每一个类别都解决一个专门的需求（比如数据去重、大型图数据分析、多种科学实验，实时流处理），或是发觉一个特定的硬件平台（比如廉价机器的集群或是超多核心的服务器）。为了解决这些问题，需要并行计算和高效地处理数据量大于内容容量数据集的专业知识。</p>
<h2 id="跨平台集成">跨平台集成</h2><p>给定系统的多样性，平台需要被集成或是联合起来，为跨系统分析数据提供可能。这和让数据的格式透明化相关，更和跨数据系统间的数据访问和数据流动的性能优化相关。这也要求管理系统需要跨设备和数据中心运行。在网络连接不稳定的情况下，设备离线的情况逐渐地变得常见，这就带来了可信数据的输入，查询处理和数据不一致的挑战。</p>
<h2 id="编程模型">编程模型</h2><p><strong>一个多样、数据驱动的世界需要多样的编程抽象，方便开发者在大型数据集上进行操作。</strong>一个面向大数据的数据分析语言，比如一个SQL的超集并不能满足所有人的需求。更进一步，用户必须用他们最熟悉的语言来进行数据的分析：SQL，Pig，R，Python，领域特定的语言或是一个低级别的限制性编程模型，例如MapReduce，或是Valiant的批量同步处理模型。同样建议开发可重用的可以多种语言绑定的中间件，比如可伸缩的矩阵计算库、数组操作、程式化地迭代执行模型等。另一个可能成果丰硕的方向在于，为新领域的数据分析开发领域特定的分析语言，并直接将这种可扩展、并行处理的思想结合在其中。</p>
<h2 id="数据处理流程">数据处理流程</h2><p>为了应对数据的多样性，我们需要平台可以处理“生”和“熟”的数据。被处理过的“熟”数据可以是很多种形态：表格、矩阵或是图。系统会运行端到端的工作流，其中多种类型的数据被混合处理，比如说，通过SQL查询出的数据接着使用R进行分析。为了统一不同的系统，懒计算有时有一定的优势————懒数据解析、懒转换、懒加载、懒索引和创建视图，及时（JIT）查询计划。大数据系统应该变得更加可互操作，就像是Lego积木一般。<br>集群资源管理器，比如Hadoop2.0的YARN，在系统层面提供了一些灵感，Hadoop生态圈的工作流系统和科学工作流的工具也给了我们一些启示。</p>
<h1 id="端到端的数据处理">端到端的数据处理</h1><p>数据库研究团体需要给予端到端的数据处理更多的关注。在多年研究的成果中，我们很少看到能不在人进行关键性干涉的情况下，从原始数据逐步提取到知识的工具。对于大多数步骤来说，干涉的人需要对计算机有深入的了解。</p>
<h2 id="数据到知识处理管线">数据到知识处理管线</h2><p>原始数据到知识管线基本就是如下步骤：数据获取、选取、评估、清洗和变换（也被称为“数据扯皮”）、抽取和整合、挖掘、联机分析、结果总结、证明和解释。除了更大的规模外，其他显著变化的包括了数据和用户的多样性。现在，数据以各种形式出现，通常非结构化和结构化会以结构化的形式结合起来用。在分析管线的每一步中，数据工具必须利用人类的反馈，并且必须是相关领域的专家，而不是IT专业人员。例如，一个记者想要从一个记录有罪犯数据的表格中清晰、统计和发布数据。工具也必须为新出现的数据科学家团体量身定做。</p>
<h2 id="工具的多样性">工具的多样性</h2><p>既然没有一个全能的工具可以应对所有的数据分析场景，我们需要多种工具，每个都需要一个原始数据到知识的处理管线。它们必须可以被无缝地衔接起来，可以被入门菜鸟和专家使用。每个工具提供最佳实践来给予使用者充分的指导。</p>
<h2 id="工具的可定制性">工具的可定制性</h2><p>工具必须可以利用相关的领域知识，比如字典、知识库和规则。它们应该可以很轻易地进行领域的定制，有可能通过机器学习来自动化这一定制化过程。人工编辑的规则的地位依然很高，但是由于很多分析应用需要极高的精确度，例如电子商务。对于这些应用，分析师经常要写规则来覆盖一些边缘个例，着对于学习和泛化就不可行。所以，工具必须为编辑、评估、应用和管理人工规则提供支持。</p>
<h2 id="开源">开源</h2><p>在此领域内很少有工具是开源的。大多数都需要较高的授权费用，并只针对数据处理步骤中的特定步骤。这样造成的后果是，现有的工具不能直接从数据研究团体方面获得贡献。</p>
<h2 id="理解数据">理解数据</h2><p>解释、证明、过滤、总结和可视化是让分析工具更好用的几个关键点。捕获并且管理恰当的元信息是让解释、出处、重用和可视化成为可能的一个关键点。可视化分析逐渐获得了数据库、可视化和人机交互领域研究人员的关注。在本领域持续的研究成果对于应对大容量数据的用户十分重要。</p>
<h2 id="知识库">知识库</h2><p>我们对于一个目标领域获知的知识越多，工具越能好地分析这个领域。结果是，为了获得更好的理解数据，创建、分享和使用领域知识蒸逐渐地流行起来。这样的知识通常被储存在知识库之中，其中描述了一个领域中非常多重要的概念和关系，比如一个知识库存储了数十万的生物学研究人员和他们发表的研究成果、隶属关系和专利。这样的知识库被用来提高数据到知识管线的准确性，回答领域内的一些问题，并找寻相关的领域专家。很多公司已经构建了这样的知识库来回答用户的查询、对文本进行标注和支持电子商务，分析社交网络数据。知识库是比较准确的，这导致了一些社区维护的“知识中心”的发展，它们提供了查询、分享的工具，并使用知识库进行数据分析。</p>
<p>在此话题已经不断有工作进展的基础上，我们需要更多的精力被投入一下工作上，提供工具帮助不同能力层次的用户协同地构建、维护、查询和分享领域内专业知识的知识库。</p>
<h1 id="云服务">云服务</h1><p>云计算目前大致可以分为三类：</p>
<ul>
<li>IaaS，服务就是虚拟化后的硬件</li>
<li>PaaS，服务是虚拟化后的基础设施软件，例如DBMS</li>
<li>SaaS，服务就是一个应用软件服务，比如一个CRM解决方案</li>
</ul>
<p>从一个数据平台的角度来看，PaaS是最理想的。用户可以上传数据到云上，和传统数据库一样通过SQL进行查询，并选择性地分享数据和查询结果。这一切都不需要考虑需要租多少个机器实例，使用什么操作系统，如何在多机器间分表和怎样进行数据库调优。虽然一些类似的服务已经出现了，比如Salesforce的Database.com，Google的Big Query，Amazon的Redshift和Microsoft的Azure SQL Database。我们还没有达到最理想的服务。如下，我们列出了一些关键的挑战来实现数据Paas的愿景。</p>
<h2 id="可伸缩性">可伸缩性</h2><p>数据的迁移代价非常高。NAS让数据库引擎可以轻易地进行扩展，但是网络延时和带宽限制着数据库的性能。SAS降低了这些限制，但是服务器宕机将会造成服务可用性降级，最终影响SLAs。</p>
<p>一个公开的问题是是否云存储服务可以支持事务和分析，缓存怎样才能被最好地嵌入整个系统中还是不太明确。为了提供伸缩性，数据PaaS的数据库引擎和分析平台需要可以正常地运行，即使是在底层资源可能随时由于业务需要进行扩容的情况下。对于付费的优质用户，提供优先级更高的服务。</p>
<h2 id="数据冗余复制">数据冗余复制</h2><p>对于地理位置分散的数据中心，其相互之间的延时让数据的备份并保持一致性、高吞吐和低响应时间有了很大难度。多主数据备份是一个不错的选择，这是由于在不同复制副本上发生冲突的更新可以被自动同步。不过这个编程模型对于主流的编程人员来说不太直观。所以，主要挑战在于如何最优地权衡可用性、一致性、编程复杂度和代价。</p>
<h2 id="系统管理和调优">系统管理和调优</h2><p>对于Data PaaS来说，不存在数据库和系统管理员这两个角色。所以，管理工作必须被自动化，比如容量估计，资源供给和物理数据管理。资源管理参数也需要以极高的响应度被自动计算出，例如缓冲池大小和权限管理。</p>
<h2 id="多“租户”">多“租户”</h2><p>一个数据PaaS的竞争力来自其价格要比内部部署的解决方案低。这就需要提供商将多个用户的需求打包运行在相同的硬件资源上，通过分享来减少开销。首先，数据得在用户之间被隔离防止数据泄露。这可以通过将用户的数据库分散在不同的文件中，或是通过虚拟机进行隔离。不过，这对规模小的数据库非常不经济，并且想在多个VM之间均衡分配资源也是困难的。其他解决方案可以是用户分享一个数据库和数据库引擎，但需要特殊地身份限制保证安全。第二，用户想要定义了性能和可用性的SLA，提供商也希望SLA来提供分级分价格的服务，不过，怎样定义SLA让客户易于理解，让服务商易于实现是一个挑战。实现的困难在于保证客户之间的性能分离，即一个客户突发的高访问量不会导致另一个客户的服务被降级影响到。</p>
<h2 id="数据分享">数据分享</h2><p>云计算让分享达到了从未有过的高度。一个问题是如何支持入数据管理等核心功能的云上合作。还有其他问题包括：怎样找到有用的公开数据，怎样将私有管理的数据和公开数据相关联，怎样在网上找到优质的数据，怎样以细粒度做数据分享，怎样在分享数据和计算的同时分担开支，怎样给数据定价。云计算页造成了新的数据什么周期问题，比如在云服务提供商发生故障的时候应该怎么做，怎样在使用者和提供者完全没有关联的情况下，持久保存数据。云计算也会驱动数据管理方面的工具创新，比如审计、法律条文的健全。</p>
<h2 id="混合云">混合云</h2><p>将在线数据服务、自部署的服务和移动设备结合的需求是存在的。其中的一个使用场景就是工作负载分流。比如在一般情况下，用户可能在他们的私有云中运行应用，不过可能在流量峰值到来的时候使用公有云进行负载分流。还有一个例子是物联网，例如车辆会将本地的传感器数据聚集后上传其中一些到云平台中，并且基于从多方聚集的数据获得控制信息。物联网系统与从多个传感器和移动设备获取的信息流有关，并且必须应对间断性的网路传输和有限的电池资源，这对于实时造成了挑战，并且页可能让云端的数据管理成为了一个关键任务。</p>
<h1 id="人在数据生命周期中的职责">人在数据生命周期中的职责</h1><p>回到企业驱动的数据管理时代，人员的职责非常的明确：</p>
<ul>
<li>开发者开发数据库和以数据库为和谐的应用</li>
<li>商业分析师使用（基于SQL的）报表工具，查询数据库</li>
<li>终端用户产生数据，查询或是更新数据库</li>
<li>数据库管理员对数据库和工作流进行监测与调优</li>
</ul>
<p>现在，一个人可能将扮演数据生命周期中的多个角色，而有些角色可能需要众包来解决。所以，对于查询的理解和优化、判别相关和可信的数据源、定义和持续优化数据处理管线、可视化相关的特征模式、获得查询结果、将任务分解为大量小任务供专家或是用户来解决，人的因素需要被详细地考量。我们将人的角色分为四个大类：生产者、管理者、消费者和社区成员。</p>
<h2 id="数据生产者">数据生产者</h2><p>今天，基本上所有人都可以通过手机、社交平台、应用和可穿戴设备生成源源不断的信息流。对于数据库社区一个关键的挑战是设计算法和激励方式指导人们生产并分享最有用的数据，同时保证自己需要的隐私不泄露。当人们生产数据的时候，我们怎么帮助他们快而准确地添加元信息。比如说用户上传照片后，Facebook就会自动地将人脸区域都标注出来，这样用户就可以选择是否对人脸进行标注。另一个例子是一个自动帮推文加话题标签的工具。我们还能做什么类似的工作吗，或者我们还可以提供什么通用的原则和工具？</p>
<h2 id="数据管理者">数据管理者</h2><p>数据不再仅仅存在于数据库中，只被DBA或是被IT部门所掌控了。现在，很多人都有权利对数据进行管理。众包是其中的实现方法之一。这其中的一个关机挑战是基于一个不完美的人类数据管理者，获取到一个高质量的数据集合。<strong>我们需要构建允许用户轻松管理数据的平台，并扩展相关的应用来与管理者合作。</strong>对于这种以人为中心的挑战，数据源头和解释将成为一个重点，隐私与安全也同样重要。</p>
<h2 id="数据消费者">数据消费者</h2><p>人们总是提出诸多的数据使用方法和更加混乱的数据，这提出了很多挑战。在企业中，数据消费者通常了解如何针对一个结构化的表格写SQL查询。而现在数据消费者有可能不知道如果生成一个查询语句了，比如说一个希望在一个结构化数据集上找出“在佛罗里达有100,000人口以上所有城市的平均温度”的新闻工作者。如果想让人们自己找出这些问题的答案，就需要提供新的查询界面了，比如基于多点触摸的界面而不是传统的SQL。我们需要多种整合了可视化、查询和导航的界面。当用户的查询不明确的时候，需要提供给用户其他浏览、探索、可视化和挖掘数据的方法，让数据消费更加简单。</p>
<h2 id="在线社区">在线社区</h2><p>人们想要创建、分享和管理其他社群的数据。他们想合作构建社群对应的知识库、Wiki和处理数据的工具。比如说，很多研究人员在Google Scholar上面创建了自己的主页。<br>对于我们来说，挑战就是帮助社群构建数据挖掘、分享和探索的工具。</p>
<h1 id="社区带来的挑战">社区带来的挑战</h1><p>除了研究领域的挑战，数据库领域还面对着不少社区难题。这包含数据库教学、数据科学和研究文化。有一些是大数据带来的新难题，有一些则是被大数据加剧了的旧问题。</p>
<h2 id="数据库教学">数据库教学</h2><p>目前标准的数据库课程已经难以与现在的实际需要相衔接了。目前的教学内容集中植根在上世纪八十年代，那时内存相比于数据库的存储容量来说非常小，I/O就成了很多数据库操作的瓶颈，并且当时的服务器都配备相对较为昂贵的单核处理器。而现在，很多数据直接可以在内存中装下，多核处理器让并行和缓存行为成为了衡量数据库的一个标准。虽然基于SQL的数据管理系统被广泛使用，键值存储、数据流式处理和MapReduce框架也已经广泛普及。目前需要重新审视整个数据库教学计划。</p>
<h2 id="数据科学">数据科学</h2><p>如我们之前所谈到的，大数据需要数据科学家来辅助将大量的数据转换为可以使用的知识。数据科学家不仅仅需要数据管理的知识，也需要商业智能、计算机系统、数学、统计学、机器学习和优化相关的知识。新的跨专业学科项目需要集中这些专业知识。成功的研究和教学需要其他学科和领域专家的辅助。大数据给了计算机科学一个影响化学、地球科学、社会学和其他领域的机会。这些课程中计算机科学的一小部分可以让数据管理和科学扮演一个更加突出的位置。</p>
<h2 id="科研文化">科研文化</h2><p>目前一个现象是比起研究成果的影响，人们更加关注论文的引用数量。这就影响了大型项目、端到端工具和数据集分享的实施，因为这通常需要花费更多的时间。太注重偏门学科方向深挖而不注重实际影响的学科团体需要注意一下，发表论文的频率应该回归到更加合理范围，我们应该鼓励大型的系统项目、工具集和数据分享。</p>
<h1 id="向前推进">向前推进</h1><p>现在对于数据库研究人员来说真是个令人激动的时代。在以前，数据库研究都限制在企业需求和关系型数据库下。大数据的兴起和大数据驱动时间愿景带来了诸多的挑战：利用新硬件、软件和云平台的潜力；指出数据的生命周期，从数据的产生、分析到分享；面对数据的多样性、在大数据处理各个方面的人物的角色。现在也需要重新审视数据库的教育、数据消费者的演化和我们的价值体系。这对我们评估、传播和资助研究也有很重要的意义。</p>
<h1 id="致谢">致谢</h1><p>感谢审阅者给出的无价建议。Beckman会议是由Ram Kumar Memorial教授的基金会，微软公司和Walmart实验室赞助的</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/10/find-more-transmission-peers-to-boost-seeding-speed-automaticly/" itemprop="url">
                  为了加快PT分享速度，自动督促Transmission获取更多Peers
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Posted on
            <time itemprop="dateCreated" datetime="2016-09-10T14:40:37+08:00" content="2016-09-10">
              2016-09-10
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; In
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/10/find-more-transmission-peers-to-boost-seeding-speed-automaticly/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/10/find-more-transmission-peers-to-boost-seeding-speed-automaticly/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="为何要如此努力地增加PT分享率">为何要如此努力地增加PT分享率</h1><p>学校内连接外网的代价还是挺大的，更不要说在线串流电影或是下载了。虽然我没有追剧的压力，看电影的偏好也比较单一，PT的压力不会很大，不过加入北邮人PT后，使用的是全新的账号，由于怕分享率太低被封禁账号，还是需要在下载资源后，利用电脑的空闲资源，在电影看完被删掉前借此增加一点分享率。</p>
<p>理想情况是，电影下好后在观看过程中进行分享，如果一直有较好的上传速度的话，很快就可以流量回本了，无奈几次实验下来，几乎没有分享多少流量，导致分享率已经跌倒了0.1。</p>
<p>大概有这几点原因导致了我分享率很低：</p>
<ul>
<li>有些我想看的资源已经是冷门资源</li>
<li>我的网络环境太差，其他人从我这获取资源的速度太慢，导致我只能分享他下载流量的很小比例</li>
<li>我一般看完就删，分享时间非常有限</li>
<li>PT内网环境中，大家的下载速度都很快，并且有很多人分享，别人在不知道我这里有资源的情况下就已经下载完成了</li>
</ul>
<p>其中冷门资源想看只能使用其他资源的上传来补了；从我的下载速度可以稳定在10MB/s看来，网络环境不是瓶颈；我并不想囤积电影，看完就删的习惯不准备改变，也不准备话很长时间挂机分享；看来，针对免费的热门资源，如何提高自己的分享效率成为了比较好的方案。</p>
<h1 id="Transmission">Transmission</h1><p>Transmission是Linux上很不错的BT下载器，PT资源也支持，它还支持一个Web客户端，Web客户端使用Http与Transmission服务部通信，这就为我们自动话督促分享量提供了机会。</p>
<p>细看Transmission的一个任务，发现其中Peers通常是由Tracker来提供的，但这里显示Transmission每半个小时才会去询问一次有没有更多Peers，这边就带来了可能很多Peers需要下载我分享的资源时候，我并不知道这一情况，错失了很多上传机会。</p>
<p><img src="/images/find-more-transmission-peers-to-boost-seeding-speed-automaticly/transmission.png" alt="Transmission"></p>
<p>人工通过在任务上<code>右键</code>&gt;<code>Ask Tracker For More Peers</code>刷了几分钟后，发现上传速度能维持在一个不错的水平了。</p>
<h1 id="解决方案">解决方案</h1><p>其实就通过查看Web客户端是如何请求Transmission服务器，每隔一段时间强制刷新Peers列表就可以了。</p>
<h2 id="获取Web客户端与Transmission的通信规范">获取Web客户端与Transmission的通信规范</h2><p>首先通过<code>Transmission</code>&gt;<code>Preferences</code>&gt;<code>Remote</code>&gt;<code>Allow Remote Access</code>打开Web客户端。</p>
<p><img src="/images/find-more-transmission-peers-to-boost-seeding-speed-automaticly/web-client.png" alt="Webclient"></p>
<p>然后通过<code>Chrome Dev Tools</code>审查Web客户端和服务器的请求。</p>
<p><img src="/images/find-more-transmission-peers-to-boost-seeding-speed-automaticly/chrome-devtools.png" alt="ChromeDevTools"></p>
<p>分析请求发现<code>torrent-get</code>获取任务ID和详情信息，<code>torrent-reannounce</code>向Tracker发出刷新Peers列表的请求。</p>
<p>通过<code>Copy as cURL</code>直接复制Chrome发出的请求，方便进行实验。</p>
<h2 id="通过脚本自动化刷新Peers列表的过程">通过脚本自动化刷新Peers列表的过程</h2><p>最终整理Shell脚本如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取Transmission的Session ID，不然后续请求无效</span></span><br><span class="line">TSID=`curl <span class="operator">-s</span>I <span class="string">'http://localhost:9091/transmission/rpc'</span> |grep -Fi <span class="string">"X-Transmission-Session-Id"</span> | tr <span class="operator">-d</span> <span class="string">'\r'</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$TSID</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取当前任务的ID列表，通过jq工具解析Json</span></span><br><span class="line">TDATA=`curl <span class="operator">-s</span> <span class="string">'http://localhost:9091/transmission/rpc'</span> -H <span class="string">'Origin: http://localhost:9091'</span> -H <span class="string">'Accept-Encoding: gzip, deflate'</span> -H <span class="string">'Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.6,en;q=0.4'</span> -H <span class="string">"<span class="variable">$TSID</span>"</span> -H <span class="string">'Content-Type: json'</span> -H <span class="string">'Accept: application/json, text/javascript, */*; q=0.01'</span> -H <span class="string">'Referer: http://localhost:9091/transmission/web/'</span> -H <span class="string">'X-Requested-With: XMLHttpRequest'</span> -H <span class="string">'DNT: 1'</span> --data-binary <span class="string">'&#123;"method":"torrent-get","arguments":&#123;"fields":["id"],"ids":"recently-active"&#125;&#125;'</span> --compressed | jq -c <span class="string">'&#123;"method":"torrent-reannounce","arguments":&#123;ids: [.arguments.torrents[].id]&#125;&#125;'</span> | tr <span class="operator">-d</span> <span class="string">'\r'</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$TDATA</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发出刷新Peers列表的请求</span></span><br><span class="line">curl <span class="string">'http://localhost:9091/transmission/rpc'</span> -H <span class="string">'Origin: http://localhost:9091'</span> -H <span class="string">'Accept-Encoding: gzip, deflate'</span> -H <span class="string">'Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.6,en;q=0.4'</span> -H <span class="string">"<span class="variable">$TSID</span>"</span> -H <span class="string">'Content-Type: json'</span> -H <span class="string">'Accept: application/json, text/javascript, */*; q=0.01'</span> -H <span class="string">'Referer: http://localhost:9091/transmission/web/'</span> -H <span class="string">'X-Requested-With: XMLHttpRequest'</span> -H <span class="string">'DNT: 1'</span> --data-binary <span class="string">"<span class="variable">$TDATA</span>"</span> --compressed</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每隔一分钟刷新一次</span></span><br><span class="line">sleep <span class="number">60</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure></p>
<p>其中有一个坑在将一个命令的输出存入Shell变量时候，有时末尾会有’\r’这个字符，但echo这个变量又和不带’\r’的字符串看不出区别。如果不通过<code>tr -d &#39;\r&#39;</code>删除的话，curl发出的请求就不能被正常相应。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/07/some-shell-and-sql-problems-from-leetcode/" itemprop="url">
                  一些来自LeetCode的Shell和Sql问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Posted on
            <time itemprop="dateCreated" datetime="2016-09-07T21:41:18+08:00" content="2016-09-07">
              2016-09-07
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; In
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/programming/" itemprop="url" rel="index">
                    <span itemprop="name">programming</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/07/some-shell-and-sql-problems-from-leetcode/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/07/some-shell-and-sql-problems-from-leetcode/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>Shell和Sql都是日常工作中经常使用的工具，发现LeetCode还有一些<a href="https://leetcode.com/problemset/shell/" target="_blank" rel="external">Shell</a>和<a href="https://leetcode.com/problemset/database/" target="_blank" rel="external">Sql</a>问题，由于项目中写Shell和Sql不是很多，练习的时候有些题目还稍微遇到了一点困难，记录如下。</p>
<h1 id="Shell">Shell</h1><h2 id="192-_Word_Frequency"><a href="https://leetcode.com/problems/word-frequency/" target="_blank" rel="external">192. Word Frequency</a></h2><p>难度：<code>Medium</code><br>题目大意：</p>
<ul>
<li>写一个bash脚本计算<code>word.txt</code>文件中每个单词出现的频率</li>
<li>只存在小写字母单词表，单词只使用一个或是多个空格分割</li>
<li>输出频率时候按照降序排列，由于保证单词的频率相互不重复，不用考虑再使用字典序做二次排序</li>
</ul>
<p>示例输入：<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">the</span> <span class="property">day</span> <span class="keyword">is</span> sunny <span class="keyword">the</span> <span class="keyword">the</span></span><br><span class="line"><span class="keyword">the</span> sunny <span class="keyword">is</span> <span class="keyword">is</span></span><br></pre></td></tr></table></figure></p>
<p>示例输出：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">the <span class="number">4</span></span><br><span class="line">is <span class="number">3</span></span><br><span class="line">sunny <span class="number">2</span></span><br><span class="line">day <span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<h3 id="使用sort/uniq计算频率">使用sort/uniq计算频率</h3><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> words.txt | tr -s ' ' '\<span class="keyword">n</span>' | <span class="keyword">sort</span> | uniq -c | <span class="keyword">sort</span> -r | awk '&#123; <span class="keyword">print</span> <span class="label">$2</span>, <span class="label">$1</span>  &#125;'</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>tr -s</strong> : 将空格替换为换行，其中<code>-s  --squeeze-repeats</code>指明将连续的空格视为一个空格</li>
<li><strong>sort</strong>  : 按照字典序排序，为统计频率做准备，因为uniq只能统计连续出现的单词</li>
<li><strong>uniq -c</strong> : 将排序后单词序列中连续出现的重复单词去重，<code>-c</code>将重复次数输出</li>
<li><strong>sort -r</strong> : 按照频率降序排列结果</li>
<li><strong>awk</strong> : 将输出结果的第一栏和第二栏调换输出</li>
</ul>
<h3 id="仅仅使用awk和sort">仅仅使用awk和sort</h3><p>awk功能非常强大。<br><figure class="highlight monkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="comment">'&#123;for(i=1;i&lt;=NF;i++) a[$i]++&#125; END &#123;for(k in a) print k,a[k]&#125;' words.txt | sort -k2 -nr</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>awk的对于每一行生效的指令中，对于每一行的每一栏的单词，将他们统计到map中</li>
<li>awk最后指令，将单词与频率输出</li>
<li><strong>sort -k2 -nr</strong> : 使用第二栏的数据，进行降序排序</li>
</ul>
<h2 id="194-_Transpose_File"><a href="https://leetcode.com/problems/transpose-file/" target="_blank" rel="external">194. Transpose File</a></h2><p>难度：<code>Medium</code><br>题目大意：</p>
<ul>
<li>写一个bash脚本转置<code>file.txt</code>给出单词的矩阵</li>
<li>单词只使用一个空格分割</li>
</ul>
<p>示例输入：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name age</span><br><span class="line">alice <span class="number">21</span></span><br><span class="line">ryan <span class="number">30</span></span><br></pre></td></tr></table></figure></p>
<p>示例输出：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name alice ryan</span><br><span class="line">age <span class="number">21</span> <span class="number">30</span></span><br></pre></td></tr></table></figure></p>
<h3 id="awk">awk</h3><p>还是继续awk大法好，awk其实类似于一个文件处理的编程框架。<br>awk和sed使用好，比直接写shell和使用各种命令进行管道叠加要效率高并且可读性高。<br><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">awk '&#123;</span><br><span class="line">    row=NR<span class="comment">;</span></span><br><span class="line">    col=NF<span class="comment">;</span></span><br><span class="line">    for(i=<span class="number">1</span><span class="comment">;i&lt;=NF;i++) a[NR, i]=$i;</span></span><br><span class="line">&#125;</span><br><span class="line">END &#123;</span><br><span class="line">    for(i=<span class="number">1</span><span class="comment">;i&lt;=col;i++) &#123;</span></span><br><span class="line">        printf(<span class="string">"%s"</span>, <span class="literal">a</span>[<span class="number">1</span>, i])<span class="comment">;</span></span><br><span class="line">        for(j=<span class="number">2</span><span class="comment">;j&lt;=row;j++)</span></span><br><span class="line">            printf(<span class="string">" %s"</span>, <span class="literal">a</span>[j, i])<span class="comment">;</span></span><br><span class="line">        print <span class="string">""</span><span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;' file.txt</span><br></pre></td></tr></table></figure></p>
<p>直接将单词矩阵存下来，然后转置输出。</p>
<h1 id="Sql">Sql</h1><h2 id="176-_Second_Highest_Salary"><a href="https://leetcode.com/problems/second-highest-salary/" target="_blank" rel="external">176. Second Highest Salary</a></h2><p>难度：<code>Easy</code><br>题目大意：</p>
<ul>
<li>从<code>Employee</code>表中选出第二高的薪水记录</li>
<li>如果不存在第二高的记录，返回<code>null</code></li>
</ul>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">+----+</span>--------+</span><br><span class="line"><span class="header">| Id | Salary |</span><br><span class="line">+----+--------+</span></span><br><span class="line">| 1  | 100    |</span><br><span class="line">| 2  | 200    |</span><br><span class="line"><span class="header">| 3  | 300    |</span><br><span class="line">+----+--------+</span></span><br></pre></td></tr></table></figure>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select ifnull(</span><br><span class="line">    (select <span class="keyword">distinct</span> <span class="type">Salary</span> <span class="keyword">from</span> <span class="type">Employee</span> order by <span class="type">Salary</span> desc limit <span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">, null) <span class="keyword">as</span> <span class="type">SecondHighestSalary</span></span><br></pre></td></tr></table></figure>
<p>使用<code>ifnull</code>函数进行记录是否为空的判断。</p>
<h2 id="178-_Rank_Scores"><a href="https://leetcode.com/problems/rank-scores/" target="_blank" rel="external">178. Rank Scores</a></h2><p>难度：<code>Medium</code><br>题目大意：</p>
<ul>
<li>用Sql来为分数分级，对于相同的分数，分为同一级，下一级和前一级别连续编号。</li>
</ul>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">+----+</span>-------+</span><br><span class="line"><span class="header">| Id | Score |</span><br><span class="line">+----+-------+</span></span><br><span class="line">| 1  | 3.50  |</span><br><span class="line">| 2  | 3.65  |</span><br><span class="line">| 3  | 4.00  |</span><br><span class="line">| 4  | 3.85  |</span><br><span class="line">| 5  | 4.00  |</span><br><span class="line"><span class="header">| 6  | 3.65  |</span><br><span class="line">+----+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="header">输出：</span><br><span class="line">+-------+------+</span></span><br><span class="line"><span class="header">| Score | Rank |</span><br><span class="line">+-------+------+</span></span><br><span class="line">| 4.00  | 1    |</span><br><span class="line">| 4.00  | 1    |</span><br><span class="line">| 3.85  | 2    |</span><br><span class="line">| 3.65  | 3    |</span><br><span class="line">| 3.65  | 3    |</span><br><span class="line"><span class="header">| 3.50  | 4    |</span><br><span class="line">+-------+------+</span></span><br></pre></td></tr></table></figure>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> Score,</span><br><span class="line">       ( @<span class="built_in">rank</span> := @<span class="built_in">rank</span> + ( @<span class="built_in">prev</span> &lt;&gt; (@<span class="built_in">prev</span> := Score)  )  ) as Rank</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> Score <span class="keyword">from</span> Scores order <span class="keyword">by</span> Score <span class="built_in">desc</span></span><br><span class="line">) A, (<span class="keyword">select</span> @<span class="built_in">rank</span> := <span class="number">0</span>, @<span class="built_in">prev</span> := -<span class="number">1</span>) Init</span><br></pre></td></tr></table></figure>
<p>参考他人解法，使用零时表中的两个变量，分别记录分级编号和上一个分数，方便判断是否分数相同。</p>
<h2 id="180-_Consecutive_Numbers"><a href="https://leetcode.com/problems/consecutive-numbers/" target="_blank" rel="external">180. Consecutive Numbers</a></h2><p>难度：<code>Medium</code><br>题目大意：</p>
<ul>
<li>用Sql选出连续出现三次即以上的数字</li>
</ul>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+----+-----+</span><br><span class="line">|<span class="string"> Id </span>|<span class="string"> Num </span>|</span><br><span class="line">+----+-----+</span><br><span class="line">|<span class="string"> 1  </span>|<span class="string">  1  </span>|</span><br><span class="line">|<span class="string"> 2  </span>|<span class="string">  1  </span>|</span><br><span class="line">|<span class="string"> 3  </span>|<span class="string">  1  </span>|</span><br><span class="line">|<span class="string"> 4  </span>|<span class="string">  2  </span>|</span><br><span class="line">|<span class="string"> 5  </span>|<span class="string">  1  </span>|</span><br><span class="line">|<span class="string"> 6  </span>|<span class="string">  2  </span>|</span><br><span class="line">|<span class="string"> 7  </span>|<span class="string">  2  </span>|</span><br><span class="line">+----+-----+</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">select</span> <span class="keyword">distinct</span> <span class="keyword">Num</span> <span class="keyword">as</span> ConsecutiveNums <span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">Id</span>, <span class="keyword">Num</span>, ( @<span class="keyword">rank</span> := <span class="keyword">if</span>(@prev = (@prev := <span class="keyword">NUM</span>), @<span class="keyword">rank</span>+<span class="number">1</span>, <span class="number">1</span>)  ) <span class="keyword">as</span> <span class="keyword">Rank</span></span><br><span class="line">    <span class="keyword">from</span> <span class="keyword">Logs</span>, (<span class="keyword">select</span> @<span class="keyword">rank</span> := <span class="number">1</span>, @prev := -<span class="number">1</span>) Init</span><br><span class="line">) <span class="keyword">as</span> temp <span class="keyword">where</span> <span class="keyword">Rank</span> = <span class="number">3</span>;</span></span><br></pre></td></tr></table></figure>
<p>参考178的思路，将每条记录按照是否连续进行编号，再把所有有三次连续出现的不重复数字选出。</p>
<h2 id="184-_Department_Highest_Salary"><a href="https://leetcode.com/problems/department-highest-salary/" target="_blank" rel="external">184. Department Highest Salary</a></h2><p>难度：<code>Medium</code><br>题目大意：</p>
<ul>
<li>挑选出每个部门最高薪水的记录</li>
</ul>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="header">Employee:</span><br><span class="line">+----+-------+--------+--------------+</span></span><br><span class="line"><span class="header">| Id | Name  | Salary | DepartmentId |</span><br><span class="line">+----+-------+--------+--------------+</span></span><br><span class="line">| 1  | Joe   | 70000  | 1            |</span><br><span class="line">| 2  | Henry | 80000  | 2            |</span><br><span class="line">| 3  | Sam   | 60000  | 2            |</span><br><span class="line">| 4  | Max   | 90000  | 1            |</span><br><span class="line">| 5  | Janet | 69000  | 1            |</span><br><span class="line"><span class="header">| 6  | Randy | 85000  | 1            |</span><br><span class="line">+----+-------+--------+--------------+</span></span><br><span class="line"></span><br><span class="line"><span class="header">Department:</span><br><span class="line">+----+----------+</span></span><br><span class="line"><span class="header">| Id | Name     |</span><br><span class="line">+----+----------+</span></span><br><span class="line">| 1  | IT       |</span><br><span class="line"><span class="header">| 2  | Sales    |</span><br><span class="line">+----+----------+</span></span><br><span class="line"></span><br><span class="line"><span class="header">输出：</span><br><span class="line">+------------+----------+--------+</span></span><br><span class="line"><span class="header">| Department | Employee | Salary |</span><br><span class="line">+------------+----------+--------+</span></span><br><span class="line">| IT         | Max      | 90000  |</span><br><span class="line"><span class="header">| Sales      | Henry    | 80000  |</span><br><span class="line">+------------+----------+--------+</span></span><br></pre></td></tr></table></figure>
<h3 id="解法1：900ms">解法1：900ms</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">select</span> <span class="keyword">d</span>.<span class="keyword">name</span> <span class="keyword">as</span> Department, <span class="keyword">e</span>.<span class="keyword">Name</span> <span class="keyword">as</span> Employee, Salary</span><br><span class="line"><span class="keyword">from</span> Employee <span class="keyword">e</span> <span class="keyword">inner</span> <span class="keyword">join</span> Department <span class="keyword">d</span> <span class="keyword">on</span> <span class="keyword">e</span>.DepartmentId = <span class="keyword">d</span>.<span class="keyword">Id</span></span><br><span class="line"><span class="keyword">where</span> Salary = (<span class="keyword">select</span> <span class="keyword">max</span>(Salary) <span class="keyword">from</span> Employee <span class="keyword">where</span> DepartmentId = <span class="keyword">d</span>.<span class="keyword">Id</span>)</span></span><br></pre></td></tr></table></figure>
<p>比较暴力，有个Employee记录都有一个冗余的子查询。</p>
<h3 id="解法2：600ms">解法2：600ms</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select t3<span class="class">.Name</span> as Department, t2<span class="class">.Name</span> as Employee, t1<span class="class">.Salary</span> as Salary</span><br><span class="line">from</span><br><span class="line">(</span><br><span class="line">    select <span class="function"><span class="title">max</span><span class="params">(Salary)</span></span> as Salary, DepartmentId</span><br><span class="line">    from Employee</span><br><span class="line">    group by DepartmentId</span><br><span class="line">) t1, Employee t2, Department t3</span><br><span class="line">where t1<span class="class">.Salary</span> = t2<span class="class">.Salary</span> and t1<span class="class">.DepartmentId</span> = t2<span class="class">.DepartmentId</span> and t1<span class="class">.DepartmentId</span> = t3.Id</span><br></pre></td></tr></table></figure>
<p>先把每个部门的最高薪水一起聚合算出，再全连接表并筛选出部门和薪水都匹配的员工记录。</p>
<h2 id="185-_Department_Top_Three_Salaries"><a href="https://leetcode.com/problems/department-top-three-salaries/" target="_blank" rel="external">185. Department Top Three Salaries</a></h2><p>难度：<code>Hard</code><br>题目大意：</p>
<ul>
<li>在上一题基础上，挑选出每个部门前三高薪水的记录</li>
<li>如果少于三条记录，则只显示存在的记录</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">select</span> t1.<span class="keyword">Name</span> <span class="keyword">as</span> Department, t2.<span class="keyword">Name</span> <span class="keyword">as</span> Employee, t2.Salary <span class="keyword">as</span> Salary</span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">Name</span>, <span class="keyword">ifnull</span>((</span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">distinct</span> Salary <span class="keyword">from</span> Employee <span class="keyword">e</span> </span><br><span class="line">        <span class="keyword">where</span> <span class="keyword">e</span>.DepartmentId = <span class="keyword">d</span>.<span class="keyword">Id</span></span><br><span class="line">        <span class="keyword">order</span> <span class="keyword">by</span> Salary <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line">    , <span class="number">0</span>) <span class="keyword">as</span> Salary, <span class="keyword">Id</span> <span class="keyword">as</span> DepartmentId <span class="keyword">from</span> Department <span class="keyword">d</span></span><br><span class="line">) t1, Employee t2</span><br><span class="line"><span class="keyword">where</span> t1.Salary &lt;= t2.Salary <span class="keyword">and</span> t1.DepartmentId = t2.DepartmentId</span></span><br></pre></td></tr></table></figure>
<p>和上一题思路类似，先选出第三高的薪水，再全连接筛选。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/02/use-ipv6-to-save-network-traffic-at-school/" itemprop="url">
                  使用IPv6节省校内的网络流量开支
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Posted on
            <time itemprop="dateCreated" datetime="2016-09-02T09:26:45+08:00" content="2016-09-02">
              2016-09-02
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; In
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/tech/" itemprop="url" rel="index">
                    <span itemprop="name">tech</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/02/use-ipv6-to-save-network-traffic-at-school/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/02/use-ipv6-to-save-network-traffic-at-school/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>联网是一切的开始。学校的校园网建设还是比较完善的。从费用上来说每个月20G免费流量，就算用超价格也还是比较合理的；管理界面有查看流量报表、查看在线终端和登陆日志的功能，甚至能自动下线一些可能是蹭网的设备，考虑得很周到，用招行手机网银充值页很方便；宿舍每个床位都有网口，可以通过Web认证登陆，图书馆等公共场所还有免费的热点覆盖，速度也还不错。</p>
<h1 id="所以为什么我要想方设法节省流量的开支呢？">所以为什么我要想方设法节省流量的开支呢？</h1><ul>
<li>开支：在一周内我就把20G免费流量几乎用光，在9月的第一天用掉了1.5G流量，按照这个趋势下去，每个月开支。。。</li>
<li>良好的习惯：从我爸身上学到的精算流量、和运营商斗智斗勇的良好习惯，必须想方设法节省流量开支。</li>
<li>本科期间的陋习：本科期间使用了一些方法节省自己的流量开支，现在需要增加这个开支就心里痒痒的。</li>
<li>更好的学习与生活环境：如果上网需要担心开支问题，势必会影响获取网络上各种优质资源的积极性。</li>
<li>其他：顺带解决在宿舍无法使用路由器访问IPv6网络的困惑。</li>
</ul>
<p>于是在同学和学长的提醒下，并大概分析了我的流量都花到了什么地方后，我终于意识到了IPv6免流量的优势，并想着如何最大程度发挥IPv6的优势。</p>
<h1 id="通过路由器也能获取到IPv6地址">通过路由器也能获取到IPv6地址</h1><p>宿舍的一个网口需要同时接入手机、电脑等设备，就得使用一个无线路由器了。由于之前我一直偏好将路由器设置为<code>router</code>模式，所以在路由器的内部网路中，我的设备都没有IPv6地址。上PT下载时，还必须将网线直插到电脑上，非常麻烦。之前我一直认为这是路由器不支持IPv6的表现，但稍微考虑后发现如果路由器只是作为<code>AP</code>，充当一个无线交换机的角色后，电脑手机是可以直接从校园网自动获取到独立的IPv6地址的，虽然这样稍微有点不安全，因为我习惯用路由器做一个保护，防止其他用户可以直接访问到我电脑的端口。<br>使用的路由器是mini型的低端路由器，切换成为<code>AP</code>模式后就无登陆密码保护了，这时候需要手动调整电脑IP到路由器使用的子网段，再访问路由器管理界面设置密码。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ifconfig wlan0 <span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span> netmask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br></pre></td></tr></table></figure></p>
<h1 id="我的流量都去哪儿了？">我的流量都去哪儿了？</h1><p>虽然并没有详细的统计结果，但我主要耗费的流量在于</p>
<ul>
<li>看Youtube每日订阅的视频，耗费了大量的流量，并且由于在VPS上开了冗余发包（用于低质量网路环境加速），可能实际流量是视频流量的2-3倍。</li>
<li>其他外网网站访问流量，刷推、查看RSS订阅、搜索和Google办公套件等。</li>
<li>更新电脑和手机软件，耗费不多，但也是比较大的一部分开销。</li>
<li>偶尔看国内视频，耗费不多。</li>
<li>PT下载电影，已经使用IPv6了。</li>
<li>国内的网站访问流量。</li>
</ul>
<p>由于使用私人梯子，并且看Youtube等外网流量都是走梯子的，所以如果我和VPS之间的流量转换为IPv6，就应该能节省一大笔流量了。并且从这个思路看，也可以找国内的IPv6代理中转来节省在国内的流量。</p>
<h1 id="配置影梭监听IPv6地址">配置影梭监听IPv6地址</h1><p>使用的搬瓦工VPS申请IPv6地址非常容易，在控制面板 &gt; Admin functions &gt; IPv6 Addresses 内添加地址即可，几分钟生效。<br>由于IPv6地址目前几乎是使用不完的，可以申请到一个子网的全部地址，不过目前使用其中一个就行了。</p>
<p><img src="/images/use-ipv6-to-save-network-traffic-at-school/add_ipv6.png" alt="add_ipv6"></p>
<p>然后启动两个影梭服务器实例，分别监听IPv4和IPv6地址：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"server"</span>:<span class="string">"0.0.0.0"</span> # IPv4 地址</span><br><span class="line"><span class="string">"server"</span>:<span class="string">"::"</span> # IPv6 地址</span><br><span class="line"></span><br><span class="line"># 启动服务器</span><br><span class="line"><span class="regexp">/usr/</span>bin<span class="regexp">/ss-server -c /</span>etc<span class="regexp">/shadowsocks/</span>config.json -a root -u -f <span class="regexp">/var/</span>run<span class="regexp">/shadowsocks/</span>shadowsocks.pid</span><br><span class="line"><span class="regexp">/usr/</span>bin<span class="regexp">/ss-server -c /</span>etc<span class="regexp">/shadowsocks/</span>config6.json -a root -u -f <span class="regexp">/var/</span>run<span class="regexp">/shadowsocks/</span>shadowsocks6.pid</span><br></pre></td></tr></table></figure>
<p>最后在电脑上启动两个客户端，分别连接两个服务器，并监听两个本地端口，这样方便在本机没有IPv6地址的时候进行切换。</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># local hosts</span></span><br><span class="line">x.x.x.x yqf.<span class="keyword">me</span></span><br><span class="line">y:y:y:y:y:y:y:y yqfv6.<span class="keyword">me</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># v4</span></span><br><span class="line"><span class="string">"server"</span>: <span class="string">"yqf.me"</span>,</span><br><span class="line"><span class="string">"local_port"</span>: <span class="number">11000</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment"># v6</span></span><br><span class="line"><span class="string">"server"</span>: <span class="string">"yqfv6.me"</span>,</span><br><span class="line"><span class="string">"local_port"</span>: <span class="number">11001</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动客户端</span></span><br><span class="line">ss-<span class="keyword">local</span> <span class="comment">--fast-open -c /path/to/config.json &amp;</span></span><br><span class="line">ss-<span class="keyword">local</span> <span class="comment">--fast-open -c /path/to/config6.json &amp;</span></span><br></pre></td></tr></table></figure>
<p>至此所有外网的流量就走IPv6了。</p>
<h1 id="电脑软件更新">电脑软件更新</h1><ul>
<li><p>通过命令行指定使用IPv6。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="keyword">get</span> -o Acquire::ForceIPv6=<span class="literal">true</span> install pkg</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过更换校园网内部的源来节省这一部分流量，看到校园内还有AOSP的镜像，表示万一有这方面需求可以节省很多流量了。</p>
</li>
</ul>
<h1 id="通过Chrome查看DNS缓存记录">通过Chrome查看DNS缓存记录</h1><p>可以通过<code>chrome://net-internals/#dns</code>查看一下有哪些网站已经支持了IPv6，youku没有支持。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/avatar.png" alt="yqf" itemprop="image"/>
          <p class="site-author-name" itemprop="name">yqf</p>
        </div>
        <p class="site-description motion-element" itemprop="description"></p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">43</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">11</span>
              <span class="site-state-item-name">categories</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">38</span>
              <span class="site-state-item-name">tags</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/yqf3139" target="_blank">
                  
                    <i class="fa fa-globe"></i> github
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/yqf3139" target="_blank">
                  
                    <i class="fa fa-globe"></i> twitter
                  
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/ke-yu-beta" target="_blank">
                  
                    <i class="fa fa-globe"></i> zhihu
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2009 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yqf</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"yqf3139"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     


    
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
